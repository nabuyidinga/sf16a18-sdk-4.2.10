#!/bin/ash

# return to web before kick_sta , need '&'
if [ "$1" = "repeater" ]; then
    sleep 2
    # set channel
    chan=$2
    # judge channel is 5G or 2.4G
    if [ $chan -lt 20 ]; then
        uci set wireless.radio0.channel="$chan"
    else
        uci set wireless.radio1.htmode='VHT80'
        if [ $chan -eq 165 ]; then
            uci set wireless.radio1.htmode='VHT20'
        fi
        uci set wireless.radio1.channel="$chan"
    fi
    uci commit wireless
    uci del_list uhttpd.main.index_page='cgi-bin/test.lua'
    uci del_list uhttpd.main.index_page='index.htm'
    uci set uhttpd.main.error_page='/index.htm'
    uci add_list uhttpd.main.index_page='index.htm'
    uci commit
    /etc/init.d/uhttpd restart
    wifi reload
    ubus call lepton.network kick_sta
    ifconfig eth0 down; sleep 2;ifconfig eth0 up
elif [ "$1" = "ap" ]; then
    sleep 2
    wifi reload
    ubus call lepton.network kick_sta
else
    echo "$0 param error" > /dev/ttyS0
fi
